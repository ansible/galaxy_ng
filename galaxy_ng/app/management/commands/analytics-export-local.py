import logging

from django.core.management.base import BaseCommand
from galaxy_ng.app.management.commands.analytics.collector import LocalCollector
from galaxy_ng.app.management.commands.analytics import galaxy_collector
from django.utils.timezone import now, timedelta

logger = logging.getLogger("analytics")


class Command(BaseCommand):
    """Django management command to export collections data to local disk"""

    def handle(self, *args, **options):
        """Handle command"""

        collector = LocalCollector(
            collector_module=galaxy_collector,
            collection_type="manual",
            logger=logger,
        )

        collector.gather(since=now() - timedelta(days=8), until=now() - timedelta(days=1))

        print("Completed ")


if __name__ == "__main__":
    cmd = Command()
    cmd.handle()
