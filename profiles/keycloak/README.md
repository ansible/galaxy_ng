# galaxy_ng/keycloak

## Usage

*Add a description detailing what this profile does and any extra instructions for using it.*

#. Start the Keycloak instance and dependencies

   .. code-block:: console
   
     $ oci-env compose up -d keycloak kc-postgres ldap

#. Bootstrap the Keycloak instance with a Realm and Client then capture the needed public key

   .. code-block:: console
   
     $ ansible-playbook ./profiles/keycloak/keycloak-playbook.yaml
     # Try again if it fails at the first run, services might not be available yet.

#. Update your ``.compose.env`` file with the public key found at the end of the playbook run

   .. code-block:: console

     PULP_SOCIAL_AUTH_KEYCLOAK_PUBLIC_KEY="keycloak-public-key"

After the standard development set up steps, when you access http://localhost:8002 it will redirect to a Keycloak Open ID Connect flow login page, where you can login with one of the development SSO user's credentials (the password is the username).

#. Login to the `Keycloak instance <http://localhost:8080/>`_ with admin/admin to edit the LDAP user's roles: Choose a development SSO user, select Role Mappings > Client Roles > automation-hub and add the ``hubadmin`` role. A user is associated with the appropriate group(s) using the user_group pipeline.


## Extra Variables

*List any extra variables that user's can configure in their .compose.env*

- `PULP_SOCIAL_AUTH_KEYCLOAK_PUBLIC_KEY`
    - Description: keycloak public key. This will be generated by the ansible playbook
    - Default: unset